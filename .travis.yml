language: python
addons:
    apt:
        sources:
            - travis-ci/sqlite3
        packages:
            - sqlite3
python:
    - '2.7'
    - '3.6'
services:
    - postgresql
env:
    - 'TEST_DATABASE=sqlite:///:memory:' 
    - 'TEST_DATABASE=postgresql://postgres@localhost/travis_ci_test' 
install:
    - pip install --upgrade setuptools pytest coverage pytest-cov
    - pip install -e .[postgres]
before_script:
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    - ./cc-test-reporter before-build
    - psql -c 'create database travis_ci_test;' -U postgres
script:
    - py.test --cov=metadb --cov-report xml
after_script:
    # - coverage xml
    - cat coverage.xml
    - ./cc-test-reporter --debug after-build --exit-code $TRAVIS_TEST_RESULT
# deploy:
#   provider: pypi
#   user:
#   password:
#     secure: 
#   on:
#     tags: true
#     repo: {{cookiecutter.github_account}}/{{cookiecutter.repo_name}}
#   distributions: "sdist bdist_wheel"
